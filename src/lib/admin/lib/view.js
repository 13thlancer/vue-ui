layui.define(["laytpl","layer"],function(e){var s=layui.jquery,d=layui.laytpl,i=layui.layer,t=layui.setter,y=(layui.device(),layui.hint()),p=function(e){return new r(e)},n="LAY_app_body",r=function(e){this.id=e,this.container=s("#"+(e||n))},l=JSON.stringify(jQuery.extend(layui.whconfig.page,layui.whconfig.bizpage)),u=JSON.stringify(layui.whui.getLocalData("whui_menu"));p.loading=function(e){e.append(this.elemLoad=s('<i class="layui-anim layui-anim-rotate layui-anim-loop layui-icon layui-icon-loading layadmin-loading"></i>'))},p.removeLoad=function(){this.elemLoad&&this.elemLoad.remove()},p.exit=function(){location.hash=layui.whconfig.page.login.login},p.req=function(n){var i=n.success,a=(n.error,t.response),o=function(){return t.debug?"<br><cite>URL：</cite>"+n.url:""};n.data=n.data||{},delete n.success,delete n.error;var e={};0===n.url.indexOf("..")&&(e.type="GET"),layui.whui.request(n.url,n.data,function(e){var t={};t[a.dataName]=e,"function"==typeof n.done&&n.done(t),"function"==typeof i&&i(t)},function(e,t,n){if(layui.whui.isEmptyObject(e)){r=["请求异常，请重试<br><cite>错误信息：</cite>"+n,o()].join("");p.error(r),"function"==typeof r&&r(e)}else{var r=["<cite>Error：</cite> "+(e[a.msgName]||"返回状态码异常"),o()].join("");p.error(r),"function"==typeof i&&i(e)}},e)},p.popup=function(e){var r=e.success,t=e.skin;return delete e.success,delete e.skin,i.open(s.extend({type:1,title:"提示",content:"",id:"LAY-system-view-popup",skin:"layui-layer-admin"+(t?" "+t:""),shadeClose:!0,closeBtn:!1,success:function(e,t){var n=s('<i class="layui-icon" close>&#x1006;</i>');e.append(n),n.on("click",function(){i.close(t)}),"function"==typeof r&&r.apply(this,arguments)}},e))},p.error=function(e,t){return p.popup(s.extend({content:e,maxWidth:300,offset:"t",anim:6,id:"LAY_adminError"},t))},r.prototype.render=function(i,a){var o=this;layui.router();return i=t.views+i+t.engine,s("#"+n).children(".layadmin-loading").remove(),p.loading(o.container),s.ajax({url:i,type:"get",dataType:"html",data:{v:layui.cache.version},success:function(e){var t=i.replace(layui.whconfig.page.src,"").replace(layui.whconfig.page.engine,"");if(layui.whui.isNotEmpty(l)&&l.indexOf(t)<0&&layui.whui.isNotEmpty(u)&&u.indexOf(t)<0)o.render(layui.whconfig.page.error.permission);else{var n=s(e="<div>"+e+"</div>").find("title"),r={title:n.text()||(e.match(/\<title\>([\s\S]*)\<\/title>/)||[])[1],body:e};n.remove(),o.params=a||{},o.then&&(o.then(r),delete o.then),o.parse(e),p.removeLoad(),o.done&&(o.done(r),delete o.done)}},error:function(e){p.removeLoad(),404===e.status?o.render(layui.whconfig.page.error.e404):o.render(layui.whconfig.page.error.other),o.render.isError=!0}}),o},r.prototype.parse=function(e,t,n){var r=this,i="object"==typeof e,a=i?e:s(e),o=i?e:a.find("*[template]"),l=function(t){var e=d(t.dataElem.html());t.dataElem.after(e.render(s.extend({params:u.params},t.res))),"function"==typeof n&&n();try{t.done&&new Function("d",t.done)(t.res)}catch(e){console.error(t.dataElem[0],"\n存在错误回调脚本\n\n",e)}},u=layui.router();a.find("title").remove(),r.container[t?"after":"html"](a.children()),u.params=r.params||{};for(var c=o.length;0<c;c--)!function(){var t=o.eq(c-1),n=t.attr("lay-done")||t.attr("lay-then"),e=d(t.attr("lay-url")||"").render(u),r=d(t.attr("lay-data")||"").render(u),i=d(t.attr("lay-headers")||"").render(u);try{r=new Function("return "+r+";")()}catch(e){y.error("lay-data: "+e.message),r={}}try{i=new Function("return "+i+";")()}catch(e){y.error("lay-headers: "+e.message),i=i||{}}e?p.req({type:t.attr("lay-type")||"get",url:e,data:r,dataType:"json",headers:i,success:function(e){l({dataElem:t,res:e,done:n})}}):l({dataElem:t,done:n})}();return r},r.prototype.send=function(e,t){var n=d(e||this.container.html()).render(t||{});return this.container.html(n),this},r.prototype.refresh=function(e){var t=this,n=t.container.next().attr("lay-templateid");return t.id!==n||t.parse(t.container,"refresh",function(){t.container.siblings('[lay-templateid="'+t.id+'"]:last').remove(),"function"==typeof e&&e()}),t},r.prototype.then=function(e){return this.then=e,this},r.prototype.done=function(e){return this.done=e,this},e("view",p)});